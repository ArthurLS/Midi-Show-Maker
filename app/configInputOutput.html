<!DOCTYPE html>
<html lang="fr" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <link href="../node_modules/octicons/build/build.css" rel="stylesheet">

</head>


<body>
<h1>Edit input and output configuration!</h1>

<div class="col-md-8 col-md-offset-2">
    <h1>Set input</h1>
    <select name="inputs" class="form-control" id="inputs">
    </select>
</div>

<div class="col-md-8 col-md-offset-2">
    <h1>Set output</h1>
    <select name="outputs" class="form-control" id="outputs">
    </select>
</div>

<div class="col-md-8 col-md-offset-2">
    <br>
    <button type="button" class="btn btn-success" onclick="save()">Save</button>
    <button type="button" class="btn btn-danger" onclick="quit()">Quit</button>
    </body>
</div>

<script>window.$ = window.jQuery = require('jquery');</script>


<!-- ul>(li+a+p)*10 -->

<script>
    var easymidi = require('easymidi');
    const fs = require('fs');

    //Get inputs
    var inputs = easymidi.getInputs();
    var outputs = easymidi.getOutputs();


    console.log(outputs[0]);
    console.log(inputs[1]);

    var data_file = 'app/json/project.json';
    var project = JSON.parse(fs.readFileSync(data_file));


    //Display inputs on HTML
    for(i =0;i<inputs.length;i++){
        $( "select#inputs" ).append( "<option value="+inputs[i]+">"+inputs[i]+"</option>");
    }
    //Display outputs on HTML
    for(i =0;i<outputs.length;i++){
        $( "select#outputs" ).append( "<option value="+outputs[i]+">"+outputs[i]+"</option>");
    }

    // Save configuration
    function save(){
        //Get selected values
        var inP =$("select#inputs").find(":selected").text()
        var inO =$("select#outputs").find(":selected").text()

        //Add configurations on the WebStorage
        localStorage.setItem("input",inP );
        localStorage.setItem("output", inO);

        //Add configutraions on the project.json
        project.configuration.input=inP;
        project.configuration.output=inO;
        fs.writeFileSync(data_file, JSON.stringify(project, null, 2));


    }
    // Quit configuration
    function quit(){
        console.log("quit");
        const remote = require('electron').remote;
        var window = remote.getCurrentWindow();
        window.close();
    }

</script>
</html>